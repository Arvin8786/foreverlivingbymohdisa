<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forever Living by Muhd Arvind Isa</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

<!-- =========================================================== -->
<!-- [ 1.0 ] GLOBAL STYLES & CORE HTML SHELL                       -->
<!-- =========================================================== -->
<style>
    :root {
        --primary-color: #1a5276;
        --secondary-color: #f39c12;
        --accent-color: #27ae60;
        --light-gray: #f4f6f8;
        --dark-text: #333;
        --light-text: #fff;
        --danger-color: #e74c3c;
        --border-radius: 12px;
        --shadow: 0 4px 15px rgba(0,0,0,.08);
        --font-family: 'Poppins',sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--font-family); background-color: var(--light-gray); color: var(--dark-text); line-height: 1.6; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    h1, h2, h3, h4 { color: var(--primary-color); font-weight: 600; }
    header { background-color: var(--light-text); padding: 20px 0; text-align: center; border-bottom: 1px solid #e0e0e0; }
    .header-content { display: flex; align-items: center; justify-content: center; gap: 20px; }
    .header-logo { width: 80px; height: 80px; }
    #company-name-header { margin: 0; font-size: 1.8rem; line-height: 1.2; font-weight: 600; }
    #company-name-header .by-line { font-size: 1.1rem; font-weight: 500; display: block; }
    #company-name-header .slogan { font-size: 0.9rem; color: #555; font-weight: 400; display: block; margin-top: 4px; }
    #promo-running-banner { color: var(--light-text); padding: 10px 0; font-weight: 700; background-color: var(--accent-color); overflow: hidden; white-space: nowrap; display: none; }
    #promo-running-banner .marquee-content { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; }
    @keyframes marquee { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }
    nav { background-color: var(--primary-color); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,.1); }
    nav ul { display: flex; list-style: none; padding: 10px 0; margin: 0; justify-content: center; }
    nav a { color: var(--light-text); text-decoration: none; font-weight: 600; padding: 10px 20px; cursor: pointer; }
    main { padding: 2rem 0; }
    .tab-content { display: none; } .tab-content.active { display: block; }
    .btn { display: inline-flex; align-items: center; justify-content: center; width: 100%; padding: 12px 15px; border-radius: 50px; text-decoration: none; font-weight: 700; border: none; cursor: pointer; }
    .btn-primary { background: var(--primary-color); color: var(--light-text); }
    .btn-secondary { background-color: var(--light-gray); color: var(--dark-text); }
    footer { background: var(--primary-color); color: var(--light-text); padding: 40px 20px; text-align: center; margin-top: 30px; }
    #maintenance-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 99999; background: rgba(26,82,118,0.95); color: white; justify-content: center; align-items: center; text-align: center; }
    .loader { text-align: center; padding: 3rem; font-size: 1.2rem; color: var(--primary-color); }
</style>

<div id="maintenance-overlay"></div>
<div id="store-wrapper">
  <header>
    <div class="container">
      <div class="header-content">
        <img src="FL.jpg" alt="Business Logo" class="header-logo" onerror="this.style.display='none'">
        <h1 id="company-name-header"></h1>
      </div>
    </div>
  </header>
  <div id="promo-running-banner"><div class="marquee-content" id="promo-banner-text"></div></div>
  <nav>
    <div class="container">
      <ul id="main-nav">
        <li><a onclick="showTab('homepage')">Homepage</a></li>
        <li><a onclick="showTab('products')">Products</a></li>
        <li><a onclick="showTab('about')">About Us</a></li>
        <li><a onclick="showTab('jobs')">Careers</a></li>
        <li><a onclick="showTab('enquiries')">Contact Us</a></li>
        <li><a onclick="showTab('rewards')">Rewards</a></li>
      </ul>
    </div>
  </nav>
  <main id="main-content" class="container"></main>
  <footer class="footer">
      <div class="container">
        <p id="footer-text"></p>
        <div class="timestamp">Last updated: <span id="update-timestamp"></span></div>
      </div>
  </footer>
</div>

<!-- =========================================================== -->
<!-- [ 2.0 ] DYNAMIC CONTENT PAGES MODULE                      -->
<!-- =========================================================== -->
<style>
    .hero-section { background: linear-gradient(135deg, #2c3e50, #4ca1af); color: var(--light-text); padding: 80px 20px; text-align: center; border-radius: var(--border-radius); margin-bottom: 30px; }
    .hero-section h2 { color: var(--light-text); }
    .dynamic-content-wrapper { background: var(--light-text); padding: 2.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow); margin-bottom: 2rem; }
    .why-choose-us-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; text-align: center; }
    .why-choose-us-grid i { font-size: 2.5rem; color: var(--accent-color); margin-bottom: 1rem; }
    #youtube-videos-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; }
    .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: var(--border-radius); box-shadow: var(--shadow); }
    .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    #testimonies-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
    .testimony-card { background: var(--light-gray); padding: 1.5rem; border-radius: var(--border-radius); }
    .testimony-header { text-align: center; margin-bottom: 1rem; }
    .testimony-rating { color: var(--secondary-color); font-size: 1.2rem; }
    .job-listing { border: 1px solid var(--light-gray); padding: 1.5rem; margin-bottom: 1.5rem; border-radius: var(--border-radius); }
    .job-listing ul { list-style: none; padding-left: 0; margin-top: 1rem; }
    .job-listing li { display: inline-block; background-color: var(--light-gray); padding: 5px 10px; border-radius: 15px; margin: 5px 5px 5px 0; font-size: 0.9rem; }
</style>

<!-- =========================================================== -->
<!-- [ 3.0 ] PRODUCTS MODULE                                     -->
<!-- =========================================================== -->
<style>
    .product-list { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; }
    .product { background: var(--light-text); border-radius: var(--border-radius); box-shadow: var(--shadow); display: flex; flex-direction: column; }
    .product-image-container { height: 280px; padding: 15px; display: flex; align-items: center; justify-content: center; }
    .product img { max-width: 100%; max-height: 100%; object-fit: contain; }
    .product-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
    .product h3 { margin: 0 0 10px; font-size: 1.25rem; }
    .product-actions { margin-top: auto; }
    .price-section { margin-bottom: 10px; }
    .new-price { font-weight: 700; font-size: 1.4rem; color: var(--primary-color); }
    .product .benefits, .product .consumption { font-size: .85rem; color: #555; margin: 10px 0; }
</style>

<!-- =========================================================== -->
<!-- [ 4.0 ] SHOPPING CART MODULE                                -->
<!-- =========================================================== -->
<style>
    .fab-container { position: fixed; bottom: 20px; right: 20px; z-index: 999; display: flex; gap: 15px; }
    .fab { width: 60px; height: 60px; background-color: var(--primary-color); color: var(--light-text); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; box-shadow: 0 4px 12px rgba(0,0,0,.25); cursor: pointer; position: relative; }
    #cart-count { position: absolute; top: -2px; right: -2px; background-color: var(--secondary-color); color: var(--light-text); border-radius: 50%; padding: 3px 8px; font-size: .8rem; font-weight: 700; }
    .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,.6); justify-content: center; align-items: center; }
    .modal-content { background-color: #fefefe; padding: 30px; border-radius: var(--border-radius); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
    .close { color: #aaa; float: right; font-size: 28px; font-weight: 700; cursor: pointer; }
    .cart-item { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid #eee; }
    .cart-item-details { flex-grow:1; }
    .quantity-controls { display:flex; align-items:center; gap:8px; margin-top:5px; }
    .quantity-btn { width:28px; height:28px; background:var(--light-gray); border:1px solid #ccc; border-radius:50%; cursor:pointer; font-weight:700; }
    .remove-item-btn { background:none; border:none; color:var(--danger-color); font-size:1.2rem; cursor:pointer; margin-left:15px; }
</style>

<div id="cart-modal" class="modal"></div>
<div class="fab-container" id="fab-container"></div>

<!-- =========================================================== -->
<!-- [ 5.0 ] CHATBOT MODULE                                      -->
<!-- =========================================================== -->
<style>
    #eshop-chat-widget { position: fixed; bottom: 95px; right: 20px; width: 350px; height: 500px; background: #fff; border-radius: var(--border-radius); box-shadow: 0 5px 25px rgba(0,0,0,0.15); display: flex; flex-direction: column; overflow: hidden; visibility: hidden; opacity: 0; transform: translateY(20px); transition: all 0.3s ease-in-out; z-index: 998; }
    #eshop-chat-widget.active { visibility: visible; opacity: 1; transform: translateY(0); }
    #chat-header { background: var(--primary-color); color: var(--light-text); padding: 15px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
    #close-chat-btn { background: none; border: none; color: var(--light-text); font-size: 24px; cursor: pointer; }
    #chat-body { flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
    .chat-message { max-width: 85%; padding: 10px 15px; border-radius: 18px; line-height: 1.5; }
    .bot-message { background: var(--light-gray); color: var(--dark-text); border-radius: 18px 18px 18px 5px; align-self: flex-start; }
    .user-message { background: var(--primary-color); color: var(--light-text); border-radius: 18px 18px 5px 18px; align-self: flex-end; }
    #chat-input-container { display: flex; padding: 10px; border-top: 1px solid #eee; }
    #chat-input { flex-grow: 1; border: 1px solid #ccc; border-radius: 20px; padding: 10px 15px; }
    #chat-send-btn { background: none; border: none; font-size: 20px; color: var(--primary-color); cursor: pointer; padding: 0 10px; }
</style>

<div id="eshop-chat-widget"></div>

<!-- =========================================================== -->
<!-- [ 6.0 ] FORMS MODULE (Jobs & Enquiries)                     -->
<!-- =========================================================== -->
<style>
    .enquiry-form input, .enquiry-form textarea, .enquiry-form select { width: 100%; padding: 12px; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
    .enquiry-form label { margin-top: 1rem; display: block; font-weight: 500; }
</style>

<div id="job-application-modal" class="modal"></div>

<!-- =========================================================== -->
<!-- [ 7.0 ] MAIN CONTROLLER SCRIPT                              -->
<!-- =========================================================== -->
<script>
// =================================================================
// E-Shop Frontend Script - v18.1 (Definitive Final & Corrected)
// =================================================================
const googleScriptURL = 'https://script.google.com/macros/s/AKfycbzWZVO-g0pMiHDrRHHzACOrxQIzgSG3oWInzhiEpKfM0HpccER25cCjuuvY0RHWfS4quA/exec';
const botServerURL = 'https://whatsapp-eshop-bot.onrender.com/eshop-chat';
const apiKey = '9582967';

let products = [];
let cart = [];
let allJobs = [];
let chatSession = { state: 'main_menu' };

// --- MAIN INITIALIZATION ---
document.addEventListener('DOMContentLoaded', fetchData);

async function fetchData() {
    try {
        const response = await fetch(googleScriptURL);
        if (!response.ok) throw new Error('Network response failed');
        const data = await response.json();
        if (data.status !== 'success') throw new Error(data.message || 'Unknown backend error');

        products = data.products || [];
        allJobs = data.jobsListings || [];
        
        renderStaticContent(data.aboutUsContent);
        renderMainContentShell();
        renderHomepageContent(data.aboutUsContent, allJobs, data.testimonies);
        renderProducts(products);
        renderAboutUs(data.aboutUsContent);
        renderJobs(allJobs);
        buildEnquiryForm();
        
        buildCartModal();
        buildJobApplicationModal();
        buildFabButtons();
        buildChatbotWidget();
        
        document.getElementById('update-timestamp').textContent = `${new Date().toLocaleDateString('en-GB')} (v18.1)`;
        
        document.getElementById('enquiry-form').addEventListener('submit', handleEnquirySubmit);
        document.getElementById('job-application-form').addEventListener('submit', handleJobApplicationSubmit);
        document.getElementById('chat-send-btn').addEventListener('click', handleChatSubmit);
        document.getElementById('chat-input').addEventListener('keyup', (event) => { if (event.key === "Enter") handleChatSubmit(); });

        showTab('homepage');

    } catch (error) {
        console.error("Fatal Error fetching store data:", error);
        document.getElementById('main-content').innerHTML = `<p style="text-align: center; color: red;">Error loading store. Please try again later.</p>`;
    }
}

// --- UI & CONTENT RENDERING ---
function renderStaticContent(content) {
    if (!content) return;
    document.getElementById('company-name-header').innerHTML = `${content.CompanyName || ''} <span class="by-line">${content.Owner} - ${content.Role}</span> <span class="slogan">${content.Slogan}</span>`;
    document.getElementById('footer-text').textContent = content.Footer || `© ${new Date().getFullYear()} ${content.CompanyName}`;
    const banner = document.getElementById('promo-running-banner');
    if (content.RunningBanner) {
        document.getElementById('promo-banner-text').textContent = content.RunningBanner;
        banner.style.display = 'block';
    } else {
        banner.style.display = 'none';
    }
}

function renderMainContentShell() {
    const main = document.getElementById('main-content');
    main.innerHTML = `
        <div id="homepage" class="tab-content">
            <section id="homepage-hero" class="hero-section"></section>
            <section id="why-choose-us" class="dynamic-content-wrapper"></section>
            <section id="youtube-videos" class="dynamic-content-wrapper"><h2>Learn More</h2><div id="youtube-videos-container"></div></section>
            <section id="homepage-testimonies" class="dynamic-content-wrapper"><h2>What Our Customers Say</h2><div id="testimonies-container"></div></section>
            <section id="homepage-featured-jobs" class="dynamic-content-wrapper"><h2>Join Our Team</h2><div id="featured-jobs-container"></div><a onclick="showTab('jobs')" class="btn btn-secondary" style="display: table; margin: 20px auto 0;">View All Career Opportunities</a></section>
        </div>
        <div id="products" class="tab-content"><div id="product-list-container"></div></div>
        <div id="about" class="tab-content"><section id="about-us-content" class="dynamic-content-wrapper"></section></div>
        <div id="jobs" class="tab-content"><section id="jobs-content" class="dynamic-content-wrapper"><h2>All Career Opportunities</h2><div id="job-listings-container"></div></section></div>
        <div id="enquiries" class="tab-content"><section id="enquiries-form-content" class="dynamic-content-wrapper"></section></div>
        <div id="rewards" class="tab-content"><section class="dynamic-content-wrapper"><h2>Rewards Program</h2><p>Our exciting new rewards program is coming soon! Stay tuned for more details.</p></section></div>
    `;
}

function renderHomepageContent(about, jobs, testimonies) {
    if (!about) return;
    const heroContainer = document.getElementById('homepage-hero');
    if (heroContainer) heroContainer.innerHTML = `<h2>${about.CompanyName || 'Welcome'}</h2><p>${about.Slogan || 'High-quality wellness products'}</p>`;
    
    const whyChooseUsContainer = document.getElementById('why-choose-us');
    if (whyChooseUsContainer) whyChooseUsContainer.innerHTML = `<h2>${about.WhyChooseUs_Title}</h2><div class="why-choose-us-grid"><div><i class="${about.Point1_Icon}"></i><p>${about.Point1_Text}</p></div><div><i class="${about.Point2_Icon}"></i><p>${about.Point2_Text}</p></div><div><i class="${about.Point3_Icon}"></i><p>${about.Point3_Text}</p></div></div>`;
        
    const videosContainer = document.getElementById('youtube-videos-container');
    const videoUrls = about.YoutubeURL ? about.YoutubeURL.split(',').map(url => url.trim()) : [];
    if (videosContainer && videoUrls.length > 0) {
        videosContainer.innerHTML = videoUrls.map(url => {
            try {
                const videoId = new URL(url).searchParams.get('v');
                if (videoId) return `<div class="video-wrapper"><iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe></div>`;
            } catch(e) {}
            return '';
        }).join('');
    } else if(videosContainer) {
        document.getElementById('youtube-videos').style.display = 'none';
    }

    const testimoniesContainer = document.getElementById('testimonies-container');
    if (testimonies && testimonies.length > 0) {
        testimoniesContainer.innerHTML = testimonies.map(t => {
            let stars = '';
            for (let i = 0; i < 5; i++) { stars += `<i class="fa-solid fa-star" style="color: ${i < t.Rating ? 'var(--secondary-color)' : '#ccc'}"></i>`; }
            return `<div class="testimony-card"><div class="testimony-header"><div><h4>${t.ClientName}</h4><div class="testimony-rating">${stars}</div></div></div><p>"${t.Quote}"</p></div>`;
        }).join('');
    } else {
        document.getElementById('homepage-testimonies').style.display = 'none';
    }

    const featuredJobsContainer = document.getElementById('featured-jobs-container');
    const featuredJobs = jobs ? jobs.filter(j => j.isFeatured) : [];
    if (featuredJobs.length > 0) {
        featuredJobsContainer.innerHTML = featuredJobs.map(job => `<div class="job-listing-summary"><h4>${job.position}</h4><p>${job.location} | ${job.type}</p></div>`).join('');
    } else {
        document.getElementById('homepage-featured-jobs').style.display = 'none';
    }
}

function renderProducts(productsToRender) {
    const container = document.getElementById('product-list-container');
function renderProducts(productsToRender) {
    const container = document.getElementById('product-list-container');
    if (!container) {
        console.error("Product container not found.");
        return;
    }

    if (!productsToRender || productsToRender.length === 0) {
        container.innerHTML = `<p>No products are available at the moment. Please check back later.</p>`;
        return;
    }

    // This correctly creates the product list container and then maps over the products.
    container.innerHTML = `<div class="product-list">
        ${productsToRender.map(p => `
            <div class="product">
                <div class="product-image-container">
                    <img src="${p.image}" alt="${p.name}" onerror="this.src='https://via.placeholder.com/280x280?text=Image+Not+Found'">
                </div>
                <div class="product-info">
                    <h3>${p.name}</h3>
                    <div class="price-section">
                        <span class="new-price">RM ${p.price.toFixed(2)}</span>
                    </div>
                    <div class="product-benefits"><strong>Benefits:</strong> ${p.benefits || ''}</div>
                    <div class="product-consumption"><strong>Usage:</strong> ${p.consumption || ''}</div>
                    <div class="product-actions">
                        <button class="btn btn-primary" onclick="addToCart(${p.id})">Add to Cart</button>
                    </div>
                </div>
            </div>
        `).join('')}
    </div>`;
}

function renderAboutUs(content) {
    const container = document.getElementById('about-us-content');
    if (!content) { container.innerHTML = '<p>About information is unavailable.</p>'; return; }
    container.innerHTML = `<h2>About ${content.CompanyName}</h2><div class="owner-profile"><div class="owner-details"><h3>${content.Owner} - ${content.Role}</h3><div>${content.MoreDetails}</div><hr><h4>Our Mission</h4><p>${content.OurMission}</p><h4>Our Vision</h4><p>${content.OurVision}</p></div></div>`;
}

function renderJobs(jobs) {
    const container = document.getElementById('job-listings-container');
    if (!jobs || jobs.length === 0) { container.innerHTML = '<p>There are currently no open positions.</p>'; return; }
    container.innerHTML = jobs.map(job => `<div class="job-listing"><h3>${job.position}</h3><ul><li><strong>Location:</strong> ${job.location}</li><li><strong>Type:</strong> ${job.type}</li><li><strong>Citizenship:</strong> ${job.citizenship}</li><li><strong>Gender:</strong> ${job.gender}</li><li><strong>Age Range:</strong> ${job.ageRange}</li><li><strong>Salary:</strong> ${job.salary} RM</li><li><strong>Accommodation:</strong> ${job.accommodation}</li><li><strong>Work Pattern:</strong> ${job.workDayPattern}</li><li><strong>Availability:</strong> ${job.availability}</li></ul><div class="job-description">${job.description}</div><button class="btn btn-primary" onclick="toggleJobModal(true, '${job.jobId}', '${job.position}')">Apply Now</button></div>`).join('');
}

function buildEnquiryForm() {
    const container = document.getElementById('enquiries-form-content');
    container.innerHTML = `<form id="enquiry-form" class="enquiry-form"><input type="text" id="enquiry-name" placeholder="Your Full Name" required><input type="email" id="enquiry-email" placeholder="Your Email Address" required><input type="tel" id="enquiry-phone" placeholder="Your Phone Number" required><select id="enquiry-type" required><option value="" disabled selected>Select Enquiry Type...</option><option value="General Question">General</option><option value="Product Support">Product</option></select><textarea id="enquiry-message" placeholder="Your Message" rows="6" required></textarea><button type="submit" class="btn btn-primary">Submit</button><p id="enquiry-status"></p></form>`;
}

function buildCartModal() {
    const container = document.getElementById('cart-modal');
    container.innerHTML = `<div class="modal-content"><span class="close" onclick="toggleCart(true)">&times;</span><h2>Your Cart</h2><div id="cart-items"><p>Your cart is empty.</p></div><div class="cart-summary"><div class="summary-line"><span>Subtotal</span><span id="cart-subtotal">RM 0.00</span></div><div class="summary-line"><span>Shipping</span><span id="cart-shipping">RM 0.00</span></div><div class="summary-line total"><span>Total</span><span id="cart-total">RM 0.00</span></div></div><div class="customer-info-form"><h3>Customer Info</h3><input type="text" id="customer-name" placeholder="Full Name" required><input type="tel" id="customer-phone" placeholder="WhatsApp Number" required><input type="email" id="customer-email" placeholder="Email" required><textarea id="customer-address" placeholder="Address" rows="4" required></textarea></div><button class="btn btn-primary" onclick="initiateCheckout()">Complete Order</button></div>`;
}

function buildJobApplicationModal() {
    const container = document.getElementById('job-application-modal');
    container.innerHTML = `<div class="modal-content"><span class="close" onclick="toggleJobModal(false)">&times;</span><h2>Apply for <span id="job-modal-title"></span></h2><form id="job-application-form" class="enquiry-form"><input type="hidden" id="job-id-input"><input type="hidden" id="job-position-input"><input type="text" id="applicant-name" placeholder="Full Name" required><input type="email" id="applicant-email" placeholder="Email" required><input type="tel" id="applicant-phone" placeholder="Phone" required><input type="text" id="applicant-citizenship" placeholder="Citizenship" required><textarea id="applicant-message" placeholder="Tell us about yourself" rows="4"></textarea><label for="applicant-resume">Upload Resume (Mandatory)</label><input type="file" id="applicant-resume" required><button type="submit" class="btn btn-primary">Submit</button><p id="job-application-status"></p></form></div>`;
}

function buildFabButtons() {
    const container = document.getElementById('fab-container');
    container.innerHTML = `<div id="floating-cart" class="fab floating-cart-btn" onclick="toggleCart()"><i class="fa-solid fa-cart-shopping"></i><span id="cart-count">0</span></div><div class="fab chatbot-fab" onclick="toggleChatWidget(true)"><i class="fa-solid fa-robot"></i></div>`;
}

function buildChatbotWidget() {
    const container = document.getElementById('eshop-chat-widget');
    container.innerHTML = `<div id="chat-header"><span>FL e-Shop Assistant</span><button id="close-chat-btn" onclick="toggleChatWidget(false)">&times;</button></div><div id="chat-body"></div><div id="chat-input-container"><input type="text" id="chat-input" placeholder="Type your message..."><button id="chat-send-btn"><i class="fa-solid fa-paper-plane"></i></button></div>`;
}

function addToCart(productId) {
    const product = products.find(p => p.id == productId);
    const existingItem = cart.find(item => item.id == productId);
    if (existingItem) { existingItem.quantity++; } else { cart.push({ ...product, quantity: 1 }); }
    updateCartDisplay();
}

function increaseQuantity(productId) { const item = cart.find(i => i.id == productId); if (item) { item.quantity++; } updateCartDisplay(); }
function decreaseQuantity(productId) { const item = cart.find(i => i.id == productId); if (item) { item.quantity--; if (item.quantity <= 0) { removeItemFromCart(productId); } else { updateCartDisplay(); } } }
function removeItemFromCart(productId) { cart = cart.filter(item => item.id != productId); updateCartDisplay(); }

function updateCartDisplay() {
    const cartItemsContainer = document.getElementById('cart-items');
    document.getElementById('cart-count').textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
    const subtotalEl = document.getElementById('cart-subtotal');
    const totalEl = document.getElementById('cart-total');
    if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
        subtotalEl.textContent = 'RM 0.00';
        totalEl.textContent = 'RM 0.00';
        return;
    }
    cartItemsContainer.innerHTML = cart.map(item => `<div class="cart-item"><div class="cart-item-details"><strong>${item.name}</strong><div class="quantity-controls"><button class="quantity-btn" onclick="decreaseQuantity(${item.id})">-</button><span class="quantity-display">${item.quantity}</span><button class="quantity-btn" onclick="increaseQuantity(${item.id})">+</button></div></div><div style="text-align:right">RM ${(item.price * item.quantity).toFixed(2)}</div><button class="remove-item-btn" onclick="removeItemFromCart(${item.id})"><i class="fa-solid fa-trash-can"></i></button></div>`).join('');
    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    subtotalEl.textContent = `RM ${subtotal.toFixed(2)}`;
    totalEl.textContent = `RM ${subtotal.toFixed(2)}`;
}

function toggleCart(hide = false) {
    const modal = document.getElementById('cart-modal');
    modal.style.display = hide ? 'none' : 'flex';
    if (!hide) updateCartDisplay();
}

function toggleJobModal(show = false, jobId = '', jobTitle = '') {
    const modal = document.getElementById('job-application-modal');
    if (show) {
        document.getElementById('job-modal-title').textContent = jobTitle;
        document.getElementById('job-id-input').value = jobId;
        document.getElementById('job-position-input').value = jobTitle;
        modal.style.display = 'flex';
    } else {
        modal.style.display = 'none';
        document.getElementById('job-application-form').reset();
    }
}

async function handleEnquirySubmit(event) {
    event.preventDefault();
    const statusEl = document.getElementById('enquiry-status');
    statusEl.textContent = 'Sending...';
    try {
        const payload = { action: 'logEnquiry', data: { name: document.getElementById('enquiry-name').value, email: document.getElementById('enquiry-email').value, phone: document.getElementById('enquiry-phone').value, type: document.getElementById('enquiry-type').value, message: document.getElementById('enquiry-message').value } };
        await fetch(googleScriptURL, { method: 'POST', body: JSON.stringify(payload), mode: 'no-cors' });
        statusEl.textContent = 'Enquiry sent successfully!';
        event.target.reset();
    } catch (error) {
        statusEl.textContent = 'An error occurred.';
    }
}

async function handleJobApplicationSubmit(event) {
    event.preventDefault();
    const statusEl = document.getElementById('job-application-status');
    const fileInput = document.getElementById('applicant-resume');
    if (fileInput.files.length === 0) {
        statusEl.textContent = 'Resume upload is mandatory.';
        return;
    }
    statusEl.textContent = 'Submitting...';
    const file = fileInput.files[0];
    const base64File = await getBase64(file);
    const payload = {
        action: 'logJobApplication',
        data: {
            jobId: document.getElementById('job-id-input').value,
            position: document.getElementById('job-position-input').value,
            name: document.getElementById('applicant-name').value,
            email: document.getElementById('applicant-email').value,
            phone: document.getElementById('applicant-phone').value,
            citizenship: document.getElementById('applicant-citizenship').value,
            message: document.getElementById('applicant-message').value,
            resumeFile: base64File.split(',')[1],
            resumeMimeType: file.type,
            resumeFileName: file.name
        }
    };
    try {
        await fetch(googleScriptURL, { method: 'POST', body: JSON.stringify(payload), mode: 'no-cors' });
        statusEl.textContent = 'Application submitted successfully!';
        setTimeout(() => { toggleJobModal(false); }, 3000);
    } catch (error) {
        statusEl.textContent = 'An error occurred.';
    }
}

function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
}

function initiateCheckout() {
    alert('Checkout feature is under development.');
}

function getBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

function toggleChatWidget(show) {
    const chatWidget = document.getElementById('eshop-chat-widget');
    chatWidget.classList.toggle('active', show);
}

async function handleChatSubmit() {
    const input = document.getElementById('chat-input');
    const text = input.value.trim();
    if (!text) return;
    addChatMessage('user', text);
    input.value = '';
    const thinkingMsg = addChatMessage('bot', '<i>Thinking...</i>', 'html');
    
    // This is a simplified chatbot for now.
    setTimeout(() => {
        thinkingMsg.remove();
        addChatMessage('bot', 'Hello! This chatbot is currently under maintenance. Please contact the owner directly for support.');
    }, 1000);
}
</script>

</body>
</html>
```
